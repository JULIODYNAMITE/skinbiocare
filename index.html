<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mary Import Beauty Care</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Fuente Inter */
        html {
            font-family: 'Inter', sans-serif;
        }
        /* Estilos CSS personalizados para animaciones */
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }

        .animate-fade-in-out {
            animation: fadeInOut 3s ease-in-out forwards;
        }

        /* Estilos de la barra de desplazamiento para Webkit (Chrome, Safari) */
        .overflow-y-auto::-webkit-scrollbar {
            width: 8px;
        }
        .overflow-y-auto::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background: #d946ef; /* Un rosa/morado vibrante */
            border-radius: 10px;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: #c026d3; /* Un rosa/morado más oscuro */
        }

        /* Animación de pulso para el botón del carrito (rosa/morado) */
        @keyframes pulse-attention {
            0% { transform: scale(1); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1), 0 0 0 0px rgba(192, 38, 211, 0.7); } /* purple-600 con opacidad */
            50% { transform: scale(1.05); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1), 0 0 0 8px rgba(192, 38, 211, 0); }
            100% { transform: scale(1); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1), 0 0 0 0px rgba(192, 38, 211, 0.7); }
        }

        .animate-pulse-attention {
            animation: pulse-attention 2s infinite;
        }

        /* Animación de pulso para el botón de WhatsApp (verde) */
        @keyframes pulse-whatsapp-attention {
            0% { transform: scale(1); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1), 0 0 0 0px rgba(34, 197, 94, 0.7); } /* green-500 con opacidad */
            50% { transform: scale(1.05); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1), 0 0 0 8px rgba(34, 197, 94, 0); }
            100% { transform: scale(1); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1), 0 0 0 0px rgba(34, 197, 94, 0.7); }
        }

        .animate-pulse-whatsapp-attention {
            animation: pulse-whatsapp-attention 2s infinite;
        }

        /* Animación de parpadeo para el nombre de la empresa */
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .animate-blink {
            animation: blink 1.5s infinite;
        }

        /* Estilo para el logo SVG */
        .logo-svg {
            width: 4.5rem; /* Ajusta el tamaño del SVG */
            height: 4.5rem;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1)); /* Sombra sutil para el logo */
        }

        /* Animación para la barra de envíos */
        @keyframes slideInDown {
            0% { transform: translateY(-100%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .animate-slide-in-down {
            animation: slideInDown 0.5s ease-out forwards;
        }

        /* Animación para la barra de promociones (similar a slideInDown pero con un ligero retraso) */
        @keyframes slideInDownDelayed {
            0% { transform: translateY(-100%); opacity: 0; }
            50% { transform: translateY(-100%); opacity: 0; } /* Retraso */
            100% { transform: translateY(0); opacity: 1; }
        }

        .animate-slide-in-down-delayed {
            animation: slideInDownDelayed 0.8s ease-out forwards;
        }
    </style>
</head>
<body class="bg-purple-50 min-h-screen font-sans">
    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-40">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center gap-2">
                    <!-- Nuevo logo SVG: Flor estilizada -->
                    <svg
                        class="logo-svg text-purple-600"
                        viewBox="0 0 100 100"
                        fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <!-- Pétalos de la flor -->
                        <path d="M50 5 C40 20 20 20 25 50 C20 80 40 80 50 95 C60 80 80 80 75 50 C80 20 60 20 50 5Z" fill="#D946EF"/>
                        <path d="M50 5 C60 20 80 20 75 50 C80 80 60 80 50 95 C40 80 20 80 25 50 C20 20 40 20 50 5Z" fill="#C026D3" opacity="0.8"/>
                        <!-- Centro de la flor -->
                        <circle cx="50" cy="50" r="15" fill="#E879F9"/>
                        <!-- Detalles de hojas o brillo -->
                        <path d="M60 70 Q75 65 70 50" fill="none" stroke="#A21CAF" stroke-width="3" stroke-linecap="round"/>
                        <path d="M40 70 Q25 65 30 50" fill="none" stroke="#A21CAF" stroke-width="3" stroke-linecap="round"/>
                    </svg>
                    <!-- Nombre de la empresa con animación de parpadeo -->
                    <h1 class="text-2xl md:text-3xl font-bold text-purple-700 animate-blink">
                        Mary Import Beauty Care
                    </h1>
                </div>
            </div>
        </div>
    </header>

    <!-- Barra de Envíos a Todo el Perú -->
    <div class="bg-pink-500 text-white text-center py-2 shadow-md animate-slide-in-down z-30 relative">
        <p class="font-semibold text-lg md:text-xl">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-truck inline-block mr-2 -mt-1"><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><path d="M10 18H7l1.72-6.88A2 2 0 0 1 10 10h1.24a2 2 0 0 1 1.72 1.12L14 18Z"/><circle cx="7" cy="21" r="1"/><circle cx="17" cy="21" r="1"/><path d="M17 18h.65a2 2 0 0 0 1.82-1.12L22 12V6a2 2 0 0 0-2-2h-3"/></svg>
            ¡Envíos a todo el Perú!
        </p>
    </div>

    <!-- Barra de Descuentos y Promociones -->
    <div class="bg-purple-400 text-white text-center py-2 shadow-md animate-slide-in-down-delayed z-30 relative">
        <p class="font-semibold text-lg md:text-xl">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag inline-block mr-2 -mt-1"><path d="M12.586 2H2v10.586A2 2 0 0 0 2.586 13L13 23.414A2 2 0 0 0 14.414 24H22a2 2 0 0 0 2-2V14.414A2 2 0 0 0 23.414 13L13 2.586A2 2 0 0 0 12.586 2Z"/><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/></svg>
            ¡Descuentos y promociones por la compra de más de un producto!
        </p>
    </div>

    <!-- Notificación Flotante -->
    <div id="notification-container" class="fixed top-20 left-1/2 -translate-x-1/2 p-4 rounded-lg shadow-lg text-white z-50 hidden"></div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-gray-800">Nuestros Productos Bioaqua</h2>
            <p class="text-gray-600 mt-2">Cuida tu piel con lo mejor de la naturaleza y la ciencia.</p>
        </div>

        <!-- Grid de Productos -->
        <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            <!-- Los productos se renderizarán aquí mediante JavaScript -->
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white mt-12 py-6">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-500">
            <p>&copy; <span id="current-year"></span> Mary Import Beauty Care. Todos los derechos reservados.</p>
            <p class="text-sm mt-1">Tu tienda de confianza para productos de belleza.</p>
        </div>
    </footer>

    <!-- Contenedor para los botones flotantes apilados -->
    <div class="fixed bottom-6 right-6 flex flex-col items-end space-y-4 z-30">
        <!-- Botón flotante de WhatsApp con SVG inline -->
        <a
            id="whatsapp-button"
            href="https://wa.me/51901203251?text=¡Hola!%20Estoy%20interesado/a%20en%20sus%20productos%20de%20belleza%20y%20quisiera%20hacer%20una%20consulta."
            target="_blank"
            rel="noopener noreferrer"
            class="bg-green-500 text-white p-4 rounded-full shadow-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75 transition-all duration-300 ease-in-out animate-pulse-whatsapp-attention flex items-center justify-center w-14 h-14"
        >
            <svg class="w-8 h-8" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M12.04 2C7.34 2 3.57 5.78 3.57 10.47C3.57 12.08 4.01 13.59 4.77 14.9L2.02 22L9.27 19.25C10.58 19.99 12.09 20.43 13.7 20.43H13.74C18.44 20.43 22.21 16.65 22.21 11.96C22.21 7.26 18.44 2 13.74 2H12.04ZM16.29 15.01C15.94 15.82 14.77 16.22 14.15 16.22C13.53 16.22 12.91 16.03 12.38 15.48C11.85 14.93 11.33 14.2 10.97 13.68C10.61 13.15 9.77 11.97 9.77 10.79C9.77 9.61 10.59 8.95 10.85 8.68C11.11 8.42 11.45 8.35 11.66 8.35C11.87 8.35 12.08 8.35 12.29 8.35C12.49 8.35 12.69 8.35 12.89 8.68C13.1 9.01 13.43 9.77 13.59 9.98C13.76 10.19 13.86 10.29 13.97 10.4C14.08 10.51 14.19 10.61 14.29 10.72C14.4 10.83 14.51 10.94 14.62 11.05C14.73 11.16 14.84 11.27 14.95 11.38C15.06 11.49 15.17 11.6 15.28 11.71C15.39 11.82 15.5 11.93 15.61 12.04C15.72 12.15 15.83 12.26 15.94 12.37C16.05 12.48 16.16 12.59 16.27 12.7C16.38 12.81 16.49 12.92 16.6 13.03C16.71 13.14 17.15 13.58 17.26 13.69C17.37 13.8 17.48 13.91 17.59 14.02C17.7 14.13 17.81 14.24 17.92 14.35C18.03 14.46 18.14 14.57 18.25 14.68C18.36 14.79 18.47 14.9 18.58 15.01Z"/>
            </svg>
        </a>

        <!-- Botón flotante del Carrito -->
        <button
            id="cart-button"
            class="bg-purple-600 text-white p-4 rounded-full shadow-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-600 focus:ring-opacity-75 transition-all duration-300 ease-in-out animate-pulse-attention"
        >
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
            <span id="cart-item-count" class="absolute -top-1 -right-1 block h-6 w-6 rounded-full bg-pink-600 text-white text-xs font-bold flex items-center justify-center hidden">0</span>
        </button>
    </div>

    <!-- Carrito de Compras (Sidebar) -->
    <div id="shopping-cart-sidebar" class="fixed top-0 right-0 h-full w-full md:w-96 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out z-50 flex flex-col">
        <!-- Header del Carrito -->
        <div class="flex justify-between items-center p-4 border-b">
            <h2 class="text-xl font-bold text-gray-800">Carrito de Compras</h2>
            <button id="close-cart-button" class="text-gray-500 hover:text-gray-800">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
        </div>

        <!-- Cuerpo del Carrito -->
        <div id="cart-items-container" class="flex-grow overflow-y-auto p-4">
            <!-- Los ítems del carrito se renderizarán aquí mediante JavaScript -->
            <div id="empty-cart-message" class="flex flex-col items-center justify-center h-full text-center text-gray-500 hidden">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart mb-4"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                <p class="text-lg font-medium">Tu carrito está vacío</p>
                <p>Agrega productos para verlos aquí.</p>
            </div>
        </div>

        <!-- Footer del Carrito (Resumen y Cupón) -->
        <div id="cart-footer" class="p-4 border-t bg-gray-50 hidden">
            <!-- Sección de Cupón -->
            <div class="flex items-center gap-2 mb-4">
                <input
                    type="text"
                    id="coupon-input"
                    placeholder="CUPÓN DE DESCUENTO"
                    class="flex-grow p-2 border rounded-md text-sm"
                />
                <button
                    id="apply-coupon-button"
                    class="bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors text-sm font-medium"
                >
                    Aplicar
                </button>
            </div>

            <!-- Resumen de Compra -->
            <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span class="text-gray-600">Subtotal:</span>
                    <span id="subtotal-display" class="font-medium">S/ 0.00</span>
                </div>
                <div id="discount-row" class="flex justify-between text-green-600 hidden">
                    <span>Descuento (<span id="coupon-display"></span>):</span>
                    <span id="discount-display" class="font-medium">- S/ 0.00</span>
                </div>
                <div class="flex justify-between text-lg font-bold border-t pt-2 mt-2">
                    <span>Total:</span>
                    <span id="total-display" class="text-purple-600">S/ 0.00</span>
                </div>
            </div>

            <!-- Botón de Checkout que redirige a WhatsApp con el pedido -->
            <a
                id="checkout-whatsapp-button"
                href="#"
                target="_blank"
                rel="noopener noreferrer"
                class="w-full mt-4 bg-purple-600 text-white font-bold py-3 rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center"
            >
                Finalizar Compra por WhatsApp
            </a>
        </div>
    </div>

    <!-- Overlay para el carrito y el modal de producto -->
    <div id="overlay" class="fixed inset-0 bg-black/40 z-40 transition-opacity hidden"></div>

    <!-- Modal para el visor de detalles del producto -->
    <div id="product-detail-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
        <div class="relative bg-white rounded-lg p-4 max-w-4xl w-full mx-4 flex flex-col md:flex-row gap-6">
            <button id="close-product-detail-modal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>

            <!-- Columna de Imágenes -->
            <div class="w-full md:w-1/2 flex flex-col items-center justify-center relative">
                <img id="modal-product-image" src="" alt="Product Image" class="max-w-full max-h-[60vh] object-contain rounded-md mb-2"/>
                <div class="flex items-center justify-between w-full px-4">
                    <button id="modal-prev-image-btn" class="bg-gray-800/50 text-white p-2 rounded-full hover:bg-gray-800 focus:outline-none disabled:opacity-50">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left"><path d="m15 18-6-6 6-6"/></svg>
                    </button>
                    <p id="modal-image-counter" class="text-gray-700 text-sm">1/1</p>
                    <button id="modal-next-image-btn" class="bg-gray-800/50 text-white p-2 rounded-full hover:bg-gray-800 focus:outline-none disabled:opacity-50">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"/></svg>
                    </button>
                </div>
            </div>

            <!-- Columna de Detalles del Producto -->
            <div class="w-full md:w-1/2 flex flex-col justify-between">
                <div>
                    <h3 id="modal-product-name" class="text-2xl font-bold text-gray-800 mb-2"></h3>
                    <p id="modal-product-description" class="text-gray-600 text-base mb-4"></p>
                    <p id="modal-product-price" class="text-3xl font-bold text-purple-600 mb-6"></p>
                </div>
                <button id="modal-add-to-cart-btn" class="bg-pink-500 text-white px-6 py-3 rounded-lg hover:bg-pink-600 transition-colors duration-300 text-lg font-medium flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                    <span>Agregar al Carrito</span>
                </button>
            </div>
        </div>
    </div>


    <script>
        // Función para acortar la descripción
        function truncateDescription(description, maxLength) {
            // Eliminar saltos de línea y múltiples espacios para una mejor truncación
            const cleanDescription = description.replace(/\s+/g, ' ').trim();
            if (cleanDescription.length <= maxLength) {
                return cleanDescription;
            }
            return cleanDescription.substring(0, maxLength) + '...';
        }

        // Datos de Ejemplo: Productos Bioaqua
        let sampleProducts = [
            {
                id: '1',
                name: "Protector Solar De Arroz BIOAQUA Sunscreen 90+ Aclarante",
                price: 35.00, // Precio actualizado
                imageUrl: ["https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/5436/PMP20000715619/full_image-1.jpeg"],
                description: "Descubre el secreto de una piel radiante y protegida con el Protector Solar de Arroz BIOAQUA Sunscreen 90+ Aclarante. Este innovador protector solar no solo ofrece una defensa superior contra los dañinos rayos UV con su SPF 90+, sino que también incorpora extracto de arroz para ayudar a aclarar y unificar el tono de tu piel. Su fórmula ligera y de rápida absorción se funde perfectamente sin dejar residuos grasos ni sensación pegajosa, proporcionando una hidratación profunda y un acabado suave y sedoso. Ideal para uso diario, protege tu piel mientras trabajas en una tez más luminosa y uniforme. Contenido: 50g."
            },
            {
                id: '2',
                name: "Bloqueador BIOAQUA 50+ Anti-Envejecimiento UVB UVA Unificador de Tono",
                price: 30.00, // Precio actualizado
                imageUrl: ["https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/5105/PMP20000707188/full_image-1.jpeg", "https://www.bellaz.pe/web/image/product.product/7450/image_1024/Sunscreen%2050%20SPF%20verde%20-%20BQY38881?unique=9a4cb80"],
                description: "Bloqueador solar SPF 50+ PA+++. Ofrece una alta protección contra los rayos UVA y UVB, previniendo el envejecimiento prematuro y las quemaduras solares. Al bloquear los rayos UVA que causan envejecimiento prematuro y daño celular, tu piel se mantendrá joven y saludable. Es una 'tone up cream' iluminadora y refrescante, con una textura ligera que protege tu piel de los daños ultravioleta y ayuda a unificar el tono de la piel y las manchas en un efecto instantáneo, dejando una piel con efecto maquillaje. Contenido de 40g."
            },
            {
                id: '3',
                name: "Spray Aclarante BIOAQUA V7 Hidratacion Profunda BLANQUEADOR",
                price: 29.00, // Precio actualizado
                imageUrl: [
                    "https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/4171/PMP20000151674/full_image-1.jpeg",
                    "https://oechsle.vteximg.com.br/arquivos/ids/18374712-1000-1000/imageUrl_2.jpg?v=638566881252400000",
                    "https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/5105/PMP20000772165/full_image-1.jpeg", // Nueva imagen en la posición 3
                    "https://oechsle.vteximg.com.br/arquivos/ids/18374715-1000-1000/imageUrl_4.jpg?v=638566881259430000"
                ],
                description: "El Spray Aclarante BIOAQUA V7 Deep Hydration es tu aliado para una piel radiante y uniforme. Este innovador spray está formulado para proporcionar una hidratación profunda mientras ayuda a aclarar y unificar el tono de la piel. Su textura ligera se absorbe rápidamente, dejando la piel fresca, luminosa y con un aspecto revitalizado. Ideal para usar en el rostro y el cuerpo, es perfecto para refrescar la piel en cualquier momento del día y mejorar su luminosidad natural. Contenido de 200ml."
            },
            {
                id: '4',
                name: "Tónico Facial de Ácido Hialurónico", // Nombre actualizado
                price: 30.00, // Precio actualizado
                imageUrl: [
                    "https://img.joomcdn.net/19428e772d3d8e6a0a2b84ea239e319ad30324c9_original.jpeg",
                    "https://img.joomcdn.net/58cdbac2a5c2637f4a2835663f9ce94cd1e51080_original.jpeg",
                    "https://img.joomcdn.net/0e7e8f89019eca766bf30432cc972206d8389091_original.jpeg",
                    "https://img.joomcdn.net/a134cadb39a5ddd1e68d646734a38d92ef37cc21_original.jpeg"
                ],
                description: "Descubre el poder del Tónico Facial de Ácido Hialurónico, un aliado esencial para una piel profundamente hidratada y revitalizada. Este tónico ligero y de rápida absorción está formulado con ácido hialurónico, conocido por su capacidad de retener hasta 1000 veces su peso en agua, proporcionando una hidratación intensa y duradera. Ideal para preparar la piel antes de la aplicación de sérums y cremas, mejora la absorción de los siguientes productos de tu rutina. Deja la piel radiante, flexible, suave al tacto y visiblemente más luminosa. Su uso continuo ayuda a minimizar la apariencia de líneas finas y a mejorar la elasticidad general de la piel. Apto para todo tipo de piel, incluso las más sensibles. Contenido: 150ml."
            },
            {
                id: '5',
                name: "Jabón Facial BIOAQUA HA Hyaluronic Acid Water Get",
                price: 29.00, // Precio actualizado
                imageUrl: [
                    "https://bioaqua.com.co/wp-content/uploads/2023/01/Jabon-acido-hialuronico-Photoroom.png", // Imagen actualizada
                    "https://oechsle.vteximg.com.br/arquivos/ids/17895244-1000-1000/imageUrl_3.jpg?v=638508177496270000", // Nueva imagen 1
                    "https://oechsle.vteximg.com.br/arquivos/ids/17895245-1000-1000/imageUrl_2.jpg?v=638508177492700000"  // Nueva imagen 2
                ],
                description: "Experimenta una limpieza facial profunda y suave con el Jabón Facial BIOAQUA HA Hyaluronic Acid Water Get. Formulado con ácido hialurónico, este jabón ayuda a mantener la hidratación natural de la piel mientras elimina eficazmente impurezas, maquillaje y exceso de grasa. Deja la piel fresca, limpia y sin sensación de tirantez. Ideal para uso diario, prepara tu piel para absorber mejor los tratamientos posteriores. Contenido de 100g." // Descripción actualizada
            },
            {
                id: '6',
                name: "Crema Facial Hidratante BIOAQUA HA Hyaluronic Acid Water Get",
                price: 35.00, // Precio actualizado
                imageUrl: [
                    "https://cdn.shopify.com/s/files/1/0043/2691/6163/files/2_febdc513-c6d7-44b3-bd91-3aafffb1689d.jpg?v=1630118788",
                    "https://cdn.shopify.com/s/files/1/0043/2691/6163/files/1_ac8f2e18-f8e5-4042-ab8d-b0db24c34d38.jpg?v=1630118772",
                    "https://cdn.shopify.com/s/files/1/0043/2691/6163/files/4_932557de-7aa5-482b-abba-2de9501566cc.jpg?v=1630118817",
                    "https://cdn.shopify.com/s/files/1/0043/2691/6163/files/6_39d248da-c86b-42c2-b5f0-1d24c268cfd5.jpg?v=1630118844"
                ],
                description: "Hidratante y suave. Ayuda a hidratar la piel seca y deshidratada. Mejora el equilibrio hidrolípido y deja la piel más atractiva. Nutre y deja la piel suave y sedosa. El sérum contiene ácido hialurónico y un complejo hidratante de ingredientes vegetales que nutren e hidratan la piel. Deja la piel fresca, hidratada y sin tirantez. Disfruta de la textura fresca y fragante de la crema. Es una crema vegana."
            },
            {
                id: '7',
                name: "Crema Hidratante Vegana Bioaqua v7 Blanqueadora", // Título actualizado
                price: 30.00, // Precio actualizado
                imageUrl: [
                    "https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/4097/PMP20000377001/imagen3-1.jpeg",
                    "https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/4097/PMP20000377001/imagen2-1.jpeg",
                    "https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/4097/PMP20000377001/full_image-1.jpeg",
                    "https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/4097/PMP20000377001/imagen4-1.jpeg",
                    "https://cdn.shopify.com/s/files/1/0043/2691/6163/files/5_2fdac8ca-5181-4488-9c20-89501162d4c3.jpg?v=1630377942"
                ],
                description: "Crema hidratante y blanqueadora vegana V7. Esta crema está formulada para hidratar profundamente la piel mientras ayuda a unificar el tono y reducir la apariencia de manchas oscuras. Su fórmula ligera y de rápida absorción deja la piel suave, luminosa y con un aspecto más uniforme. Contenido de 50g."
            },
            // Se reinserta el producto "Sérum de Vitamina C BIOAQUA" en la posición del borrado, con id '8'
            {
                id: '8', // Nuevo ID para este producto en esta posición
                name: "Sérum de Vitamina C BIOAQUA",
                price: 33.00, // Precio actualizado
                imageUrl: [
                    "https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/4789/PMP20000862069/full_image-1.jpeg",
                    "https://img.joomcdn.net/408e74b78087086270162edb28ed486dd5a9337a_original.jpeg",
                    "https://img.joomcdn.net/423c9213a58269a809d61dd9ac418293ddfaa0a4_original.jpeg",
                    "https://img.joomcdn.net/97d55703456e121d405be4b5fe48bd2f87fd3390_original.jpeg"
                ],
                description: "Beneficios: Reduce líneas de expresión y arrugas. Activa la síntesis de colágeno para una piel más firme. Ayuda a reparar el daño y mejorar la textura de la piel. Minimiza la irritación y mejora la absorción de cremas. Aclara y unifica el tono reduciendo manchas. Características: Poder antioxidante: Protege la piel contra el daño de los radicales libres. Fórmula ligera: De rápida absorción sin sensación grasosa. Alta concentración de vitamina C: Maximiza los beneficios para la piel. Apto para todo tipo de piel: Suaviza y revitaliza sin irritar. Modo de uso: Aplica sobre el rostro limpio y seco, enfocándote en las zonas con manchas. Masajea suavemente hasta su completa absorción. Para mejores resultados, úsalo por la noche después de la limpieza facial."
            },
            {
                id: '9',
                name: "PARCHE HIDRATANTE PARA EL CONTORNO DE LOS OJOS ÁCIDO HIALURÓNICO 60PCS", // Nombre actualizado
                price: 33.00, // Precio actualizado
                imageUrl: ["https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/5436/PMP20000772261/full_image-1.jpeg"], // Imagen actualizada
                description: "Parches de hidrogel para el contorno de ojos, enriquecidos con ácido hialurónico para una hidratación profunda y duradera. Ayudan a reducir la apariencia de ojeras, bolsas y líneas finas, dejando la piel suave, firme y revitalizada. Ideales para un tratamiento intensivo que restaura la elasticidad y luminosidad de la zona. Contiene 60 parches." // Nueva descripción
            },
            {
                id: '10',
                name: "Sérum de Ácido Hialurónico KOREA LAIKOU",
                price: 33.00, // Precio actualizado
                imageUrl: [
                    "https://importacionessumak.com/cdn/shop/files/COD1111_4_e5cb38a8-eabe-4bff-bad1-5470d287251d.jpg?v=1713886048&width=1100",
                    "https://importacionessumak.com/cdn/shop/files/COD1111_3_e8e6c80b-ca6c-4590-815e-8323852847e3.jpg?v=1713886048&width=1100",
                    "https://importacionessumak.com/cdn/shop/files/COD1111_2_b8060d20-efc5-4f1b-b96e-471299197d5c.jpg?v=1713886048&width=1100"
                ],
                description: "Experimenta la hidratación definitiva con el Sérum de Ácido Hialurónico de LAIKOU, directamente desde Corea. Este potente sérum está formulado con una alta concentración de ácido hialurónico, un ingrediente clave conocido por su increíble capacidad para retener la humedad en la piel, proporcionando una hidratación profunda y duradera. Su textura ligera y de rápida absorción penetra instantáneamente, rellenando las líneas finas y arrugas, y dejando la piel visiblemente más suave, elástica y con un aspecto juvenil. Ideal para todo tipo de piel, este sérum ayuda a mejorar la barrera cutánea, proteger contra los factores ambientales y promover una tez radiante y saludable. Úsalo diariamente para revitalizar tu piel y disfrutar de un cutis fresco y revitalizado. Contenido: 17ml."
            },
            {
                id: '11', // Nuevo ID para la mascarilla de ojos de Sakura
                name: "PARCHE DE OJERAS SAKURA 60PCS - BIOAQUA", // Nombre actualizado
                price: 33.00, // Precio actualizado
                imageUrl: [
                    "https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/4911/PMP20000772217/full_image-1.jpeg" // Imagen actualizada
                ],
                description: "Revitaliza la delicada piel alrededor de tus ojos con las Mascarillas para Ojos de Sakura de BIOAQUA. Este set de 60 parches está enriquecido con extracto de flor de cerezo (Sakura), conocido por sus propiedades antioxidantes y su capacidad para iluminar y suavizar la piel. Ayudan a reducir la apariencia de ojeras, bolsas y líneas finas, dejando el contorno de ojos más firme, hidratado y radiante. Su diseño ergonómico se adapta perfectamente, permitiendo que los ingredientes activos penetren eficazmente. Disfruta de una mirada fresca y juvenil con cada aplicación. Contenido: 60 parches."
            },
            {
                id: '12', // Nuevo ID para el aceite de cabello
                name: "ACEITE PARA EL CABELLO DE MOROCCO BIOAQUA 100ML",
                price: 35.00, // Precio actualizado
                imageUrl: [
                    "https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/4789/PMP20000878539/full_image-1.jpeg",
                    "https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/4789/PMP20000878539/imagen2-1.jpeg"
                ],
                description: "Transforma tu cabello con el ACEITE PARA EL CABELLO DE MOROCCO de BIOAQUA, un elixir de belleza de 100ml diseñado para nutrir, reparar y revitalizar profundamente tu melena. Enriquecido con los beneficios del aceite de argán (conocido como 'oro líquido de Marruecos'), este tratamiento capilar es ideal para todo tipo de cabello, especialmente para aquellos secos, dañados o con frizz. Su fórmula ligera y no grasa se absorbe rápidamente, aportando brillo, suavidad y manejabilidad sin apelmazar. Ayuda a fortalecer las fibras capilares, reducir las puntas abiertas y proteger el cabello del daño causado por el calor y los factores ambientales. Con cada aplicación, tu cabello lucirá más saludable, sedoso y radiante, con un aroma delicado y exótico. Modo de uso: Aplica una pequeña cantidad sobre el cabello húmedo o seco, distribuyendo de medios a puntas. No enjuagar. Úsalo antes del peinado o como toque final para un brillo extra."
            },
            {
                id: '13', // Nuevo ID para la mascarilla de jengibre
                name: "MASCARILLA DE JENGIBRE PARA EL CABELLO - BIOAQUA",
                price: 32.00, // Precio actualizado
                imageUrl: [
                    "https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/5521/PMP20000758112/imagen2-1.jpeg",
                    "https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/5521/PMP20000758112/full_image-1.jpeg"
                ],
                description: "Revitaliza y fortalece tu cabello con la MASCARILLA DE JENGIBRE PARA EL CABELLO de BIOAQUA. Esta mascarilla intensiva, formulada con extracto de jengibre, es ideal para estimular el crecimiento del cabello, fortalecer las raíces y mejorar la circulación en el cuero cabelludo. El jengibre es conocido por sus propiedades antioxidantes y antiinflamatorias, que ayudan a mantener un cuero cabelludo sano y libre de caspa. Además, su fórmula nutritiva hidrata profundamente el cabello, dejándolo suave, brillante y más resistente a la rotura. Disfruta de un cabello con más volumen, vitalidad y un aspecto visiblemente más saludable. Perfecta para cabellos débiles, finos o con tendencia a la caída. Contenido: 500g."
            },
            {
                id: '14', // Nuevo ID para la mascarilla de olivo
                name: "Mascarilla de Olivo para el Cabello 500g - Bioaqua",
                price: 32.00, // Precio actualizado
                imageUrl: [
                    "https://importacionessumak.com/cdn/shop/files/BIO58-3_6d85b2bd-12ae-4165-bfa2-27914050e2a2.jpg?v=1739626773&width=1100",
                    "https://rimage.ripley.com.pe/home.ripley/Attachment/MKP/5521/PMP20000758095/full_image-1.jpeg"
                ],
                description: "Nutre y repara tu cabello con la Mascarilla de Olivo para el Cabello de BIOAQUA. Esta mascarilla intensiva de 500g está enriquecida con extracto de olivo, un ingrediente natural conocido por sus propiedades hidratantes, nutritivas y reparadoras. Ideal para cabellos secos, dañados o quebradizos, esta mascarilla ayuda a restaurar la vitalidad y el brillo natural del cabello. Su fórmula rica penetra profundamente en la fibra capilar, proporcionando una hidratación intensa, suavizando la cutícula y reduciendo el frizz. El uso regular de esta mascarilla dejará tu cabello más fuerte, sedoso, manejable y con un aspecto visiblemente más saludable. Disfruta de la experiencia de un cabello revitalizado y lleno de vida. Modo de uso: Después de lavar el cabello, aplica una cantidad generosa de mascarilla de medios a puntas. Deja actuar durante 5-10 minutos y enjuaga con abundante agua. Para mejores resultados, úsala 1-2 veces por semana."
            }
        ];

        // Cupones de Descuento Válidos
        const validCoupons = {
            'BIENVENIDO10': { type: 'percentage', value: 10 },
            'SKINCARE5': { type: 'fixed', value: 5.00 },
            'BIOAQUA20': { type: 'percentage', value: 20 },
        };

        // Estado global de la aplicación
        let cart = [];
        let currentCoupon = '';
        const whatsappNumber = "51901203251"; // Número de WhatsApp de Perú

        // Variables para el modal de imágenes
        let currentModalProduct = null; // Almacena el producto actual en el modal
        let currentImageIndex = 0;

        // Referencias a elementos del DOM
        const productsGrid = document.getElementById('products-grid');
        const cartButton = document.getElementById('cart-button');
        const cartItemCountSpan = document.getElementById('cart-item-count');
        const shoppingCartSidebar = document.getElementById('shopping-cart-sidebar');
        const closeCartButton = document.getElementById('close-cart-button');
        const overlay = document.getElementById('overlay'); // Un solo overlay para ambos modales
        const cartItemsContainer = document.getElementById('cart-items-container');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const cartFooter = document.getElementById('cart-footer');
        const couponInput = document.getElementById('coupon-input');
        const applyCouponButton = document.getElementById('apply-coupon-button');
        const subtotalDisplay = document.getElementById('subtotal-display');
        const discountRow = document.getElementById('discount-row');
        const couponDisplay = document.getElementById('coupon-display');
        const discountDisplay = document.getElementById('discount-display');
        const totalDisplay = document.getElementById('total-display');
        const checkoutWhatsappButton = document.getElementById('checkout-whatsapp-button');
        const notificationContainer = document.getElementById('notification-container');

        // Referencias para el modal de detalles del producto
        const productDetailModal = document.getElementById('product-detail-modal');
        const closeProductDetailModalButton = document.getElementById('close-product-detail-modal');
        const modalProductName = document.getElementById('modal-product-name');
        const modalProductDescription = document.getElementById('modal-product-description');
        const modalProductPrice = document.getElementById('modal-product-price');
        const modalProductImage = document.getElementById('modal-product-image');
        const modalImageCounter = document.getElementById('modal-image-counter');
        const modalPrevImageBtn = document.getElementById('modal-prev-image-btn');
        const modalNextImageBtn = document.getElementById('modal-next-image-btn');
        const modalAddToCartBtn = document.getElementById('modal-add-to-cart-btn');


        // Función para mostrar notificaciones
        function showNotification(message, type) {
            notificationContainer.textContent = message;
            notificationContainer.className = `fixed top-20 left-1/2 -translate-x-1/2 p-4 rounded-lg shadow-lg text-white z-50 animate-fade-in-out`;
            if (type === 'success') {
                notificationContainer.classList.add('bg-green-500');
            } else if (type === 'error') {
                notificationContainer.classList.add('bg-red-500');
            } else if (type === 'info') {
                notificationContainer.classList.add('bg-blue-500');
            }
            notificationContainer.classList.remove('hidden');

            setTimeout(() => {
                notificationContainer.classList.add('hidden');
                notificationContainer.className = `fixed top-20 left-1/2 -translate-x-1/2 p-4 rounded-lg shadow-lg text-white z-50 hidden`;
            }, 3000);
        }

        // Función para calcular totales
        function calculateTotals() {
            const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            let discount = 0;

            if (currentCoupon && validCoupons[currentCoupon]) {
                const couponData = validCoupons[currentCoupon];
                if (couponData.type === 'percentage') {
                    discount = (subtotal * couponData.value) / 100;
                } else if (couponData.type === 'fixed') {
                    discount = couponData.value;
                }
            }

            const total = Math.max(subtotal - discount, 0);

            subtotalDisplay.textContent = `S/ ${subtotal.toFixed(2)}`;
            if (discount > 0) {
                discountRow.classList.remove('hidden');
                couponDisplay.textContent = currentCoupon;
                discountDisplay.textContent = `- S/ ${discount.toFixed(2)}`;
            } else {
                discountRow.classList.add('hidden');
            }
            totalDisplay.textContent = `S/ ${total.toFixed(2)}`;

            return { subtotal, discount, total };
        }

        // Función para renderizar el carrito
        function renderCart() {
            cartItemsContainer.innerHTML = ''; // Limpiar items existentes

            if (cart.length === 0) {
                emptyCartMessage.classList.remove('hidden');
                cartFooter.classList.add('hidden');
                cartItemCountSpan.classList.add('hidden');
            } else {
                emptyCartMessage.classList.add('hidden');
                cartFooter.classList.remove('hidden');
                cartItemCountSpan.classList.remove('hidden');

                cart.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'flex items-center gap-4 p-2 border rounded-lg';
                    // Usar la primera imagen del array para el carrito
                    const imageUrl = Array.isArray(item.imageUrl) ? item.imageUrl[0] : item.imageUrl;
                    itemDiv.innerHTML = `
                        <img src="${imageUrl}" alt="${item.name}" class="w-16 h-16 object-cover rounded-md" onerror="this.src='https://placehold.co/400x400/CCCCCC/000000?text=Imagen+no+disponible';"/>
                        <div class="flex-grow">
                            <p class="font-semibold text-sm">${item.name}</p>
                            <p class="text-purple-600 text-xs">S/ ${item.price.toFixed(2)}</p>
                            <div class="flex items-center gap-2 mt-1">
                                <button data-id="${item.id}" data-action="decrease" class="p-1 rounded-full border hover:bg-gray-100 disabled:opacity-50" ${item.quantity <= 1 ? 'disabled' : ''}>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-minus"><path d="M5 12h14"/></svg>
                                </button>
                                <span class="text-sm font-medium">${item.quantity}</span>
                                <button data-id="${item.id}" data-action="increase" class="p-1 rounded-full border hover:bg-gray-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="flex flex-col items-end">
                            <p class="font-bold text-base">S/ ${(item.price * item.quantity).toFixed(2)}</p>
                            <button data-id="${item.id}" data-action="remove" class="text-gray-400 hover:text-red-500 mt-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                            </button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(itemDiv);
                });
            }
            updateCartCount();
            calculateTotals();
            updateWhatsAppLink();
        }

        // Función para actualizar el contador del carrito en el botón flotante
        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartItemCountSpan.textContent = count;
            if (count > 0) {
                cartItemCountSpan.classList.remove('hidden');
            } else {
                cartItemCountSpan.classList.add('hidden');
            }
        }

        // Función para añadir al carrito
        function addToCart(productToAdd) {
            const existingProductIndex = cart.findIndex(item => item.id === productToAdd.id);
            if (existingProductIndex > -1) {
                cart[existingProductIndex].quantity += 1;
            } else {
                cart.push({ ...productToAdd, quantity: 1 });
            }
            showNotification(`${productToAdd.name} fue agregado al carrito.`, 'success');
            renderCart();
        }

        // Función para actualizar la cantidad de un producto en el carrito
        function updateQuantity(productId, newQuantity) {
            const itemIndex = cart.findIndex(item => item.id === productId);
            if (itemIndex > -1) {
                if (newQuantity < 1) {
                    removeFromCart(productId);
                } else {
                    cart[itemIndex].quantity = newQuantity;
                    renderCart();
                }
            }
        }

        // Función para eliminar un producto del carrito
        function removeFromCart(productId) {
            const productToRemove = cart.find(item => item.id === productId);
            cart = cart.filter(item => item.id !== productId);
            showNotification(`${productToRemove.name} fue eliminado del carrito.`, 'info');
            renderCart();
        }

        // Función para aplicar cupón
        function applyCoupon(couponCode) {
            if (validCoupons[couponCode]) {
                currentCoupon = couponCode;
                showNotification(`Cupón '${couponCode}' aplicado exitosamente.`, 'success');
            } else {
                currentCoupon = '';
                showNotification(`El cupón '${couponCode}' no es válido.`, 'error');
            }
            renderCart(); // Re-renderiza para aplicar el descuento
        }

        // Función para obtener recomendación LLM
        async function getLLMRecommendation(currentProduct, allProducts) {
            const productListText = allProducts.map(p => `- ${p.name}: ${p.description}`).join('\n');
            const prompt = `Dado el siguiente producto:
            Nombre: ${currentProduct.name}
            Descripción: ${currentProduct.description}

            Y la siguiente lista de productos disponibles en nuestra tienda:
            ${productListText}

            Por favor, sugiere un producto COMPLEMENTARIO de la lista de productos disponibles que un cliente que compra "${currentProduct.name}" también podría estar interesado en comprar. Explica brevemente por qué es complementario. Si no encuentras un complemento directo, puedes sugerir el producto más relevante de la lista. Responde en español y sé conciso.`;

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will provide this
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    return text;
                } else {
                    return "No se pudo generar una recomendación en este momento.";
                }
            } catch (error) {
                console.error("Error al llamar a la API de Gemini:", error);
                return "Hubo un error al obtener la recomendación.";
            }
        }

        // Función para renderizar las tarjetas de productos
        function renderProducts() {
            productsGrid.innerHTML = ''; // Limpiar el grid antes de renderizar
            sampleProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card bg-white border border-gray-200 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 flex flex-col overflow-hidden cursor-pointer';
                productCard.dataset.productId = product.id; // Añadir ID para identificar el producto al hacer clic

                // Asegurarse de que imageUrl sea un array para consistencia
                const mainImageUrl = Array.isArray(product.imageUrl) ? product.imageUrl[0] : product.imageUrl;

                // Truncar la descripción para la vista principal
                const abbreviatedDescription = truncateDescription(product.description, 100); // Límite de 100 caracteres

                productCard.innerHTML = `
                    <div class="overflow-hidden">
                        <img
                            src="${mainImageUrl}"
                            alt="Imagen de ${product.name}"
                            class="w-full h-48 object-cover transform hover:scale-105 transition-transform duration-300"
                            onerror="this.src='https://placehold.co/400x400/CCCCCC/000000?text=Imagen+no+disponible';"
                        />
                    </div>
                    <div class="p-4 flex flex-col flex-grow">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2 truncate">${product.name}</h3>
                        <p class="text-sm text-gray-500 mb-4 flex-grow">${abbreviatedDescription}</p>
                        <div class="flex justify-between items-center mt-auto">
                            <p class="text-xl font-bold text-purple-600">S/ ${product.price.toFixed(2)}</p>
                            <button data-product-id="${product.id}" class="add-to-cart-btn bg-pink-500 text-white px-4 py-2 rounded-lg hover:bg-pink-600 transition-colors duration-300 text-sm font-medium flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                                <span>Agregar</span>
                            </button>
                        </div>
                        <!-- Botón de Recomendación LLM -->
                        <button data-product-id="${product.id}" class="get-llm-recommendation-btn bg-purple-500 text-white px-3 py-1 rounded-lg hover:bg-purple-600 transition-colors duration-300 text-xs font-medium flex items-center justify-center gap-1 mt-3 w-full">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-3 3a5 5 0 0 0-.54 7.54Z"/><path d="M14 11a2 2 0 0 0-3-3l-3 3a2 2 0 0 0 3 3z"/><path d="M22 2L19 5"/><path d="M18 6L21 9"/></svg>
                            <span>Obtener Recomendación</span>
                        </button>
                        <div id="recommendation-${product.id}" class="mt-2 text-sm text-gray-700 bg-purple-50 p-2 rounded-md border border-purple-200 hidden">
                            <p class="font-semibold text-purple-700 mb-1">Sugerencia de IA:</p>
                            <p class="recommendation-text"></p>
                        </div>
                    </div>
                `;
                productsGrid.appendChild(productCard);
            });

            // Añadir event listeners a los botones "Agregar" (dentro de la tarjeta)
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    event.stopPropagation(); // Evitar que el clic en el botón abra el modal de detalles
                    const productId = event.currentTarget.dataset.productId;
                    const product = sampleProducts.find(p => p.id === productId);
                    if (product) {
                        addToCart(product);
                    }
                });
            });

            // Añadir event listeners a los botones de recomendación LLM
            document.querySelectorAll('.get-llm-recommendation-btn').forEach(button => {
                button.addEventListener('click', async (event) => {
                    event.stopPropagation(); // Evitar que el clic en el botón abra el modal de detalles
                    const productId = event.currentTarget.dataset.productId;
                    const product = sampleProducts.find(p => p.id === productId);
                    const recommendationDiv = document.getElementById(`recommendation-${productId}`);
                    const recommendationTextSpan = recommendationDiv.querySelector('.recommendation-text');

                    if (product) {
                        event.currentTarget.disabled = true;
                        event.currentTarget.textContent = 'Cargando...';
                        recommendationDiv.classList.add('hidden'); // Ocultar recomendación anterior

                        const recommendation = await getLLMRecommendation(product, sampleProducts);
                        recommendationTextSpan.textContent = recommendation;
                        recommendationDiv.classList.remove('hidden');
                        event.currentTarget.disabled = false;
                        event.currentTarget.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-3 3a5 5 0 0 0-.54 7.54Z"/><path d="M14 11a2 2 0 0 0-3-3l-3 3a2 2 0 0 0 3 3z"/><path d="M22 2L19 5"/><path d="M18 6L21 9"/></svg><span>Obtener Recomendación</span>`;
                    }
                });
            });

            // Añadir event listeners para abrir el modal de detalles del producto
            document.querySelectorAll('.product-card').forEach(card => {
                card.addEventListener('click', (event) => {
                    const productId = event.currentTarget.dataset.productId;
                    const product = sampleProducts.find(p => p.id === productId);
                    if (product) {
                        openProductDetailModal(product);
                    }
                });
            });
        }

        // Función para actualizar el enlace de WhatsApp con el resumen del pedido
        function updateWhatsAppLink() {
            const { subtotal, discount, total } = calculateTotals();
            let message = "¡Hola! Me gustaría realizar un pedido de Mary Import Beauty Care.\n\n";
            message += "*Resumen del Pedido:*\n";

            cart.forEach((item, index) => {
                message += `${index + 1}. ${item.name} (x${item.quantity}) - S/ ${(item.price * item.quantity).toFixed(2)}\n`;
            });

            message += "\n"; // Línea en blanco para separación
            message += `Subtotal: S/ ${subtotal.toFixed(2)}\n`;
            if (discount > 0) {
                message += `Descuento (${currentCoupon}): - S/ ${discount.toFixed(2)}\n`;
            }
            message += `*Total a Pagar: S/ ${total.toFixed(2)}*\n\n`;
            message += "¡Espero tu confirmación!";

            checkoutWhatsappButton.href = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
        }

        // Funciones para el modal de detalles del producto
        function openProductDetailModal(product) {
            currentModalProduct = product;
            currentImageIndex = 0; // Siempre empezar por la primera imagen

            modalProductName.textContent = product.name;
            modalProductDescription.textContent = product.description; // Descripción completa en el modal
            modalProductPrice.textContent = `S/ ${product.price.toFixed(2)}`;
            modalAddToCartBtn.dataset.productId = product.id; // Asociar el ID del producto al botón

            updateModalImage();
            productDetailModal.classList.remove('hidden');
            overlay.classList.remove('hidden');

            // Añadir una entrada al historial del navegador al abrir el modal
            history.pushState({ modalOpen: true, productId: product.id }, '', `#product-${product.id}`);
        }

        // Esta función solo oculta el modal, no manipula el historial directamente
        function closeProductDetailModal() {
            productDetailModal.classList.add('hidden');
            overlay.classList.add('hidden');
            currentModalProduct = null;
            currentImageIndex = 0;
        }

        function updateModalImage() {
            if (currentModalProduct && currentModalProduct.imageUrl.length > 0) {
                modalProductImage.src = currentModalProduct.imageUrl[currentImageIndex];
                modalProductImage.alt = `Imagen ${currentImageIndex + 1} de ${currentModalProduct.imageUrl.length} de ${currentModalProduct.name}`;
                modalImageCounter.textContent = `${currentImageIndex + 1}/${currentModalProduct.imageUrl.length}`;

                modalPrevImageBtn.disabled = currentImageIndex === 0;
                modalNextImageBtn.disabled = currentImageIndex === currentModalProduct.imageUrl.length - 1;

                // Ocultar/mostrar botones si solo hay una imagen
                if (currentModalProduct.imageUrl.length <= 1) {
                    modalPrevImageBtn.classList.add('hidden');
                    modalNextImageBtn.classList.add('hidden');
                    modalImageCounter.classList.add('hidden');
                } else {
                    modalPrevImageBtn.classList.remove('hidden');
                    modalNextImageBtn.classList.remove('hidden');
                    modalImageCounter.classList.remove('hidden');
                }
            } else {
                // Si no hay imágenes, mostrar un placeholder
                modalProductImage.src = "https://placehold.co/400x400/CCCCCC/000000?text=Imagen+no+disponible";
                modalProductImage.alt = "Imagen no disponible";
                modalImageCounter.textContent = "0/0";
                modalPrevImageBtn.classList.add('hidden');
                modalNextImageBtn.classList.add('hidden');
                modalImageCounter.classList.add('hidden');
            }
        }

        function showNextModalImage() {
            if (currentModalProduct && currentImageIndex < currentModalProduct.imageUrl.length - 1) {
                currentImageIndex++;
                updateModalImage();
            }
        }

        function showPrevModalImage() {
            if (currentModalProduct && currentImageIndex > 0) {
                currentImageIndex--;
                updateModalImage();
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('current-year').textContent = new Date().getFullYear();
            renderProducts();
            renderCart(); // Renderiza el carrito inicialmente (vacío)

            cartButton.addEventListener('click', () => {
                shoppingCartSidebar.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
            });

            closeCartButton.addEventListener('click', () => {
                shoppingCartSidebar.classList.add('translate-x-full');
                overlay.classList.add('hidden');
            });

            // Cerrar el carrito o el modal de producto cuando se hace clic en el overlay
            overlay.addEventListener('click', () => {
                if (!shoppingCartSidebar.classList.contains('translate-x-full')) {
                    shoppingCartSidebar.classList.add('translate-x-full');
                    overlay.classList.add('hidden');
                }
                // Si el modal de producto está abierto, simular un "atrás" en el historial
                else if (!productDetailModal.classList.contains('hidden')) {
                    history.back();
                }
                // Si no hay nada abierto, simplemente ocultar el overlay
                else {
                    overlay.classList.add('hidden');
                }
            });


            // Delegación de eventos para los botones de cantidad y eliminar en el carrito
            cartItemsContainer.addEventListener('click', (event) => {
                const target = event.target.closest('button');
                if (!target) return;

                const productId = target.dataset.id;
                const action = target.dataset.action;

                if (productId && action) {
                    const item = cart.find(i => i.id === productId);
                    if (!item) return;

                    if (action === 'increase') {
                        updateQuantity(productId, item.quantity + 1);
                    } else if (action === 'decrease') {
                        updateQuantity(productId, item.quantity - 1);
                    } else if (action === 'remove') {
                        removeFromCart(productId);
                    }
                }
            });

            applyCouponButton.addEventListener('click', () => {
                applyCoupon(couponInput.value.toUpperCase());
            });

            // Event Listeners para el modal de detalles del producto
            // Al hacer clic en el botón 'X' del modal, simular un "atrás" en el historial
            closeProductDetailModalButton.addEventListener('click', () => {
                history.back();
            });

            modalPrevImageBtn.addEventListener('click', showPrevModalImage);
            modalNextImageBtn.addEventListener('click', showNextModalImage);

            modalAddToCartBtn.addEventListener('click', (event) => {
                const productId = event.currentTarget.dataset.productId;
                const product = sampleProducts.find(p => p.id === productId);
                if (product) {
                    addToCart(product);
                    // Después de añadir al carrito, simular un "atrás" para cerrar el modal
                    history.back();
                }
            });

            // Cerrar modales con la tecla ESC
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    if (!productDetailModal.classList.contains('hidden')) {
                        history.back(); // Simular back para cerrar el modal de producto
                    } else if (!shoppingCartSidebar.classList.contains('translate-x-full')) {
                        shoppingCartSidebar.classList.add('translate-x-full');
                        overlay.classList.add('hidden');
                    }
                }
            });

            // Listener para el evento popstate (botón de retroceso del navegador)
            window.addEventListener('popstate', (event) => {
                // Si el modal de producto está visible y el estado actual no indica que el modal debe estar abierto
                // (o si se ha navegado completamente fuera del estado del modal)
                if (!productDetailModal.classList.contains('hidden') && (!event.state || !event.state.modalOpen)) {
                    closeProductDetailModal(); // Cierra el modal de la UI
                }
                // Si el carrito está abierto y el estado actual no indica que el modal de producto debe estar abierto
                // (esto es para asegurar que si se navega hacia atrás desde el carrito, se cierre)
                else if (!shoppingCartSidebar.classList.contains('translate-x-full') && (!event.state || !event.state.modalOpen)) {
                    shoppingCartSidebar.classList.add('translate-x-full');
                    overlay.classList.add('hidden');
                }
            });
        });

        // Inicializar Lucide Icons
        lucide.createIcons();
    </script>
</body>
</html>
